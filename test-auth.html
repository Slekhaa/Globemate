<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Supabase Authentication</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 20px;
    }
    .test-section {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background: #2563eb;
    }
    .result {
      margin-top: 10px;
      padding: 10px;
      border-radius: 5px;
      font-family: monospace;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .success {
      background: #d1fae5;
      border: 1px solid #10b981;
      color: #065f46;
    }
    .error {
      background: #fee2e2;
      border: 1px solid #ef4444;
      color: #991b1b;
    }
    .info {
      background: #dbeafe;
      border: 1px solid #3b82f6;
      color: #1e3a8a;
    }
    input {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border: 1px solid #ddd;
      border-radius: 5px;
      box-sizing: border-box;
    }
    label {
      display: block;
      margin: 10px 0 5px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ§ª Supabase Authentication Test</h1>
    
    <!-- Test 1: Check Supabase Library -->
    <div class="test-section">
      <h3>Test 1: Check Supabase Library</h3>
      <button onclick="testSupabaseLibrary()">Run Test</button>
      <div id="result1" class="result"></div>
    </div>

    <!-- Test 2: Check Configuration -->
    <div class="test-section">
      <h3>Test 2: Check Supabase Configuration</h3>
      <button onclick="testConfiguration()">Run Test</button>
      <div id="result2" class="result"></div>
    </div>

    <!-- Test 3: Initialize Client -->
    <div class="test-section">
      <h3>Test 3: Initialize Supabase Client</h3>
      <button onclick="testInitClient()">Run Test</button>
      <div id="result3" class="result"></div>
    </div>

    <!-- Test 4: Register User -->
    <div class="test-section">
      <h3>Test 4: Register Demo User</h3>
      <label for="testName">Name:</label>
      <input type="text" id="testName" value="Demo User" />
      
      <label for="testEmail">Email:</label>
      <input type="email" id="testEmail" value="demo@test.com" />
      
      <label for="testPassword">Password:</label>
      <input type="password" id="testPassword" value="testpass123" />
      
      <button onclick="testRegister()">Register User</button>
      <div id="result4" class="result"></div>
    </div>

    <!-- Test 5: Login User -->
    <div class="test-section">
      <h3>Test 5: Login User</h3>
      <label for="loginEmail">Email:</label>
      <input type="email" id="loginEmail" value="demo@test.com" />
      
      <label for="loginPassword">Password:</label>
      <input type="password" id="loginPassword" value="testpass123" />
      
      <button onclick="testLogin()">Login</button>
      <div id="result5" class="result"></div>
    </div>

    <!-- Test 6: Check Current Session -->
    <div class="test-section">
      <h3>Test 6: Check Current Session</h3>
      <button onclick="testSession()">Check Session</button>
      <div id="result6" class="result"></div>
    </div>
  </div>

  <!-- Load Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- Supabase Configuration -->
  <script>
    window.SUPABASE_URL = 'https://zucibmuisijwpgcfnkds.supabase.co';
    window.SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1Y2libXVpc2lqd3BnY2Zua2RzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExMTM4MTIsImV4cCI6MjA4NjY4OTgxMn0.qlkuUthCeExkudOBBM-ntdrB1Aod-ZPJJfAp-oGoma4';
  </script>

  <script>
    let supabaseClient = null;

    function showResult(elementId, message, type = 'info') {
      const el = document.getElementById(elementId);
      el.textContent = message;
      el.className = `result ${type}`;
    }

    function testSupabaseLibrary() {
      showResult('result1', 'Testing...', 'info');
      
      if (typeof window.supabase !== 'undefined') {
        showResult('result1', 'âœ… SUCCESS: Supabase library is loaded!\n\nAvailable: window.supabase.createClient', 'success');
      } else {
        showResult('result1', 'âŒ ERROR: Supabase library not found!\n\nTry refreshing the page.', 'error');
      }
    }

    function testConfiguration() {
      showResult('result2', 'Testing...', 'info');
      
      const url = window.SUPABASE_URL;
      const key = window.SUPABASE_ANON_KEY;
      
      if (!url || !key) {
        showResult('result2', 'âŒ ERROR: Configuration missing!\n\nURL: ' + (url || 'NOT SET') + '\nKey: ' + (key ? 'SET' : 'NOT SET'), 'error');
      } else {
        showResult('result2', 'âœ… SUCCESS: Configuration found!\n\nURL: ' + url + '\nKey: ' + key.substring(0, 20) + '...', 'success');
      }
    }

    function testInitClient() {
      showResult('result3', 'Testing...', 'info');
      
      try {
        if (typeof window.supabase === 'undefined') {
          showResult('result3', 'âŒ ERROR: Supabase library not loaded', 'error');
          return;
        }

        supabaseClient = window.supabase.createClient(
          window.SUPABASE_URL,
          window.SUPABASE_ANON_KEY
        );
        
        showResult('result3', 'âœ… SUCCESS: Supabase client initialized!\n\nClient created successfully.', 'success');
      } catch (error) {
        showResult('result3', 'âŒ ERROR: ' + error.message + '\n\n' + error.stack, 'error');
      }
    }

    async function testRegister() {
      showResult('result4', 'Testing registration...', 'info');
      
      if (!supabaseClient) {
        showResult('result4', 'âŒ ERROR: Please run Test 3 first to initialize the client', 'error');
        return;
      }

      const name = document.getElementById('testName').value;
      const email = document.getElementById('testEmail').value;
      const password = document.getElementById('testPassword').value;

      try {
        const { data, error } = await supabaseClient.auth.signUp({
          email: email,
          password: password,
          options: {
            data: {
              full_name: name,
            }
          }
        });

        if (error) {
          showResult('result4', 'âŒ ERROR: ' + error.message + '\n\nDetails: ' + JSON.stringify(error, null, 2), 'error');
        } else {
          const message = `âœ… SUCCESS: User registered!\n\nUser ID: ${data.user.id}\nEmail: ${data.user.email}\nSession: ${data.session ? 'Created' : 'Email confirmation required'}\n\nFull Response:\n${JSON.stringify(data, null, 2)}`;
          showResult('result4', message, 'success');
        }
      } catch (error) {
        showResult('result4', 'âŒ ERROR: ' + error.message + '\n\n' + error.stack, 'error');
      }
    }

    async function testLogin() {
      showResult('result5', 'Testing login...', 'info');
      
      if (!supabaseClient) {
        showResult('result5', 'âŒ ERROR: Please run Test 3 first to initialize the client', 'error');
        return;
      }

      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;

      try {
        const { data, error } = await supabaseClient.auth.signInWithPassword({
          email: email,
          password: password,
        });

        if (error) {
          showResult('result5', 'âŒ ERROR: ' + error.message + '\n\nDetails: ' + JSON.stringify(error, null, 2), 'error');
        } else {
          const message = `âœ… SUCCESS: User logged in!\n\nUser ID: ${data.user.id}\nEmail: ${data.user.email}\nSession: ${data.session ? 'Active' : 'None'}\n\nFull Response:\n${JSON.stringify(data, null, 2)}`;
          showResult('result5', message, 'success');
        }
      } catch (error) {
        showResult('result5', 'âŒ ERROR: ' + error.message + '\n\n' + error.stack, 'error');
      }
    }

    async function testSession() {
      showResult('result6', 'Checking session...', 'info');
      
      if (!supabaseClient) {
        showResult('result6', 'âŒ ERROR: Please run Test 3 first to initialize the client', 'error');
        return;
      }

      try {
        const { data: { session }, error } = await supabaseClient.auth.getSession();

        if (error) {
          showResult('result6', 'âŒ ERROR: ' + error.message, 'error');
        } else if (session) {
          const message = `âœ… SUCCESS: Active session found!\n\nUser ID: ${session.user.id}\nEmail: ${session.user.email}\nExpires: ${new Date(session.expires_at * 1000).toLocaleString()}\n\nFull Session:\n${JSON.stringify(session, null, 2)}`;
          showResult('result6', message, 'success');
        } else {
          showResult('result6', 'âš ï¸ INFO: No active session\n\nUser is not logged in.', 'info');
        }
      } catch (error) {
        showResult('result6', 'âŒ ERROR: ' + error.message + '\n\n' + error.stack, 'error');
      }
    }

    // Auto-run first 3 tests on load
    window.addEventListener('load', () => {
      setTimeout(() => {
        testSupabaseLibrary();
        setTimeout(() => testConfiguration(), 500);
        setTimeout(() => testInitClient(), 1000);
      }, 500);
    });
  </script>
</body>
</html>
